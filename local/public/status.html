<!DOCTYPE html>
<html>
  <head>
    <title>NHome</title>
    <script defer src="/socket.io/socket.io.js"></script>
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>

        $(function() {

            var conn = io.connect('/client');

            conn.emit('getServerStatus', function (status) {
                $('#local_ip').text(status.ip);
                $('#external_ip').text(status.external_ip.replace(/^::ffff:/, ''));
                $('#app_version').text(status.version);
                $('#node_version').text(status.node_version);
                $('#node_platform').text(status.node_platform);
            });

            conn.emit('getBridges', function (bridges) {
                $('#bridge_count').text(bridges.length);
            });

            conn.emit('getDevices', function (devices) {
                $('#device_count').text(devices.length);
                $('.status-dropdown').remove();
                if (devices) devices.forEach(function (device) {

                    var d = $('<div class="status-dropdown"><div><p class="H_blue">' + device.name + '</p><p class="H_gray"></p></div><span class="arrow-down"></span></div>');

                    $('#status-view').append(d);
                });
            });

            conn.once('connect', function() {

                var start = Date.now();

                conn.emit('ping', function () {
                    $('#ping').text(Date.now() - start + 'ms');
                });
            });
        });

    </script>
    <link rel="stylesheet" type="text/css" href="/style.css">
  </head>
  <body>

        <!-- status view !-->
        <div class="content content-active" id="status-view">
            <div class="status-data">
                <p>Status</p>

                <p class="H_gray">Local: <span class="H_blue"> ON </span></p>
                <p class="H_gray">Internet: <span class="H_blue"> - </span></p>
            </div>

            <div class="status-data">
                <div>
                    <p>Version</p>
                    <p class="H_blue" id="app_version"></p>
                </div>

                <div>
                    <p>Last Update</p>
                    <p>-</p>
                </div>

                <div>
                    <p></p>
                    <div>
                    </div>
                </div>
            </div>

            <div class="status-data H_wrap">
                <p>Ping: <span class="H_gray" id="ping"></span></p>
                <p>IP: <span class="H_gray" id="local_ip"></span></p>
                <p>External IP: <span class="H_gray" id="external_ip"></span></p>
                <p>OS: <span class="H_gray" id="node_platform"></span></p>
                <p>Node Version: <span class="H_gray" id="node_version"></span></p>
            </div>

            <div class="status-data">
                <p>Devices</p>

                <div>
                    <p>Bridges: <span class="H_gray" id="bridge_count"></span></p>
                    <p>Devices: <span class="H_gray" id="device_count"></span></p>
                </div>
            </div>

        </div>
        <footer>
            <p>To invite users use <a href="https://my.nhome.ba/#/login" target="_blank" class="H_blue">NHome</a></p>
        </footer>
  </body>
</html>
