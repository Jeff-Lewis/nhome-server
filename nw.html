<!DOCTYPE html>
<html>

<head>
    <meta name="description" content="NHome Server application">
    <meta name="author" content="NHome d.o.o.">
    <meta charset="utf-8">

    <title>NHome Server</title>

    <!-- roboto !-->
    <link href='https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900' rel='stylesheet' type='text/css'>
    <!-- favicon -->
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" type="text/css" href="local/public/style.css">
</head>

<body>
    <div class="wrap">
        <header>
            <div class="server-nav">
                <div class="server-nav-tab" id="status-tab" onclick="status()">
                    <p>Status</p>
                </div>
                <div class="server-nav-tab" id="gen-set-tab" onclick="settings()">
                    <p>General Settings</p>
                </div>
                <div class="server-nav-tab" id="terminal-tab" onclick="console()">
                    <p>Terminal</p>
                </div>
            </div>
        </header>

    <iframe src="" id="tab" style="display: none; border: 0; width:100%; height: 684px"></iframe>

    <pre id="console" style="display: block; color: white; background-color: black; font-family: monospace; height: 684px; margin: 0px;"></pre>

    <script>

        var stream = require('stream');

        var entries = [];

        var weblog = new stream.Writable({
            write: function(chunk, encoding, next) {
                entries.push(chunk.toString());
                if (entries.length > 50) {
                    entries.shift();
                }
                document.getElementById('console').textContent = entries.join('');
                next();
            }
        });

        var bunyan = require('bunyan');
        var PrettyStream = require('bunyan-prettystream');

        var prettyStdOut = new PrettyStream({mode: 'short', useColor: false});
        prettyStdOut.pipe(weblog);

        var ringbuffer = new bunyan.RingBuffer({ limit: 100 });

        var log = bunyan.createLogger({
            name: 'NHome',
            streams: [{
                level: 'info',
                stream: prettyStdOut
            }, {
                level: 'info',
                type: 'raw',
                stream: ringbuffer
            }]
        });

        require('./update.js')(log, function() {
            setTimeout(function() {
                document.getElementById('tab').src = 'http://127.0.0.1:8008/settings.html';
            }, 0);
        });

        function status() {
            document.getElementById('console').style.display = 'none';
            document.getElementById('tab').style.display = 'block';
            document.getElementById('tab').src = 'http://127.0.0.1:8008/status.html';
        }

        function settings() {
            document.getElementById('console').style.display = 'none';
            document.getElementById('tab').style.display = 'block';
            document.getElementById('tab').src = 'http://127.0.0.1:8008/settings.html';
        }

        function console() {
            document.getElementById('console').style.display = 'block';
            document.getElementById('tab').style.display = 'none';
        }

    </script>
    </div>
  </body>
</html>
