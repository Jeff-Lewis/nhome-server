<!DOCTYPE html>
<html>
  <head>
    <title>NHome</title>
  </head>
  <body style="margin: 0;">
    <div style="height: 20px; width: 100%">
        <div style="width: 50%; float: left; border-bottom: 1px solid silver; text-align: center;cursor: pointer" onclick="settings()">
            Settings
        </div>
        <div style="width: 50%; float: left;  border-bottom: 1px solid silver; text-align: center; cursor:pointer" onclick="console()">
            Log
        </div>
    </div>
    <iframe src="" id="tab" style="display: none; border: 0; width:100%; height: 748px"></iframe>
    <pre id="console" style="display: block; color: white; background-color: black; font-family: monospace; height: 748px; margin: 0px;"></pre>

    <script>

        var stream = require('stream');

        var entries = [];

        var weblog = new stream.Writable({
            write: function(chunk, encoding, next) {
                entries.push(chunk.toString());
                if (entries.length > 50) {
                    entries.shift();
                }
                document.getElementById('console').textContent = entries.join('');
                next();
            }
        });

        var bunyan = require('bunyan');
        var PrettyStream = require('bunyan-prettystream');

        var prettyStdOut = new PrettyStream({mode: 'short', useColor: false});
        prettyStdOut.pipe(weblog);

        var ringbuffer = new bunyan.RingBuffer({ limit: 100 });

        var log = bunyan.createLogger({
            name: 'NHome',
            streams: [{
                level: 'info',
                stream: prettyStdOut
            }, {
                level: 'info',
                type: 'raw',
                stream: ringbuffer
            }]
        });

        require('./update.js')(log, function() {
            setTimeout(function() {
                document.getElementById('tab').src = 'http://127.0.0.1:8008/settings.html';
            }, 0);
        });

        function settings() {
            document.getElementById('console').style.display = 'none';
            document.getElementById('tab').style.display = 'block';
            document.getElementById('tab').src = 'http://127.0.0.1:8008/settings.html';
        }

        function console() {
            document.getElementById('console').style.display = 'block';
            document.getElementById('tab').style.display = 'none';
        }

    </script>
  </body>
</html>
